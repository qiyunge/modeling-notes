# Case Study – Maximum Flow through the Algorithm Paradigm Tree
# 案例：最大流问题的算法范式演化全过程

> 目标：  
> 用一个经典问题，完整走一遍  
> **DP ❌ → Greedy ❌ → 结构分析 → 图模型 → Residual Network ✅**

---

## 0. 问题定义（起点）

给定一个有向网络：
- 边有容量
- 有源点 s 和汇点 t
- 每条边流量 ≤ 容量
- 中间节点满足流守恒

目标：
> 最大化从 s 到 t 的总流量

---

## 1. 第一反应：动态规划（DP）❌

### 尝试思路
- 把问题拆成子问题：
  - 从 s 到某个中间点 v 的最大流
  - 再从 v 到 t
- 或按“路径数量 / 节点子集”定义状态

### 为什么失败（关键）

#### 1️⃣ 强全局耦合
- 一条路径用了容量
- 会直接影响 **所有其他路径的可行性**

#### 2️⃣ 没有自然的子问题边界
- “前一段流”与“后一段流”无法独立
- 状态必须记住整个剩余网络

#### 3️⃣ 状态爆炸
- DP 状态 ≈ 所有可能的容量分布
- 不可行

📌 结论：
> 最大流 **不具备自然的 DP 结构**

---

## 2. 回退尝试：贪心算法（Greedy as Probe）❌

### 最自然的贪心想法

#### Greedy v1
> 每次找一条 s → t 的路径，  
> 尽量多送流（瓶颈容量）

### 表面上看起来合理
- 每一步都“送最多”
- 似乎在逼近最优

### 但它会失败（核心）

#### 失败现象
- 早期选了一条“看起来不错”的路径
- 却：
  - 占用了关键边
  - 阻断了后续更优组合

#### 关键洞察
> 问题不是“送得不够多”，  
> 而是 **早期选择不可撤销**

📌 这是一个**极其重要的信号**：
- Greedy 失败不是随机的
- 失败来自：**需要回退 / 修正**

---

## 3. 失败分析 → 结构洞察（关键跃迁）

### Greedy 暴露出的结构问题

#### 1️⃣ 决策需要可撤销
- 之前送的流，未来可能要“收回”

#### 2️⃣ 网络不是静态的
- 每送一单位流
- 网络结构就发生变化

#### 3️⃣ 需要表示“反向可能性”
- 如果我后悔了
- 能不能把流“退回去”？

📌 这一步不是算法，而是 **建模升级**

---

## 4. 建模升级：Residual Network（残量网络）✅

### 核心思想（非常重要）

> **不要只看“还能送多少”  
> 还要看“能不能撤回”**

---

### 残量网络的构造

对每条边 (u → v, capacity = c, flow = f)：

- 正向边：  
  - 剩余容量 = c − f
- 反向边：  
  - 容量 = f（表示“可撤回”）

📌 反向边不是物理边  
📌 它是“修正自由度”的数学表达

---

## 5. 新问题表述（关键转化）

原问题：
> 最大化流量

被转化为：
> 在残量网络中，  
> **不断寻找从 s 到 t 的增广路径**

每次：
1. 找一条 s → t 的路径
2. 取瓶颈容量 Δ
3. 沿路径增广（正向加，反向减）
4. 更新残量网络

---

## 6. 为什么这个结构能保证正确性？

### 不变量（Invariant）

- 任意时刻：
  - 当前流是可行流
  - 残量网络准确描述“所有可能的修正”

### 终止条件
- 当残量网络中 **不存在 s → t 路径**
- ⇒ 当前流已无法再改进

---

## 7. 理论闭环：Max-Flow Min-Cut

### 关键定理
> 当不存在增广路径时，  
> 当前流 = 某个 s–t 割的容量

也就是说：
- 上界 = 下界
- 全局最优已达成

📌 这是结构性最优，不是枚举得到的

---

## 8. 算法范式回顾（非常重要）

### 我们实际走过的路径

| 阶段 | 结果 | 得到的信息 |
|----|----|----|
| DP | ❌ | 问题全局耦合 |
| Greedy | ❌ | 需要回退机制 |
| 失败分析 | ✅ | 结构暴露 |
| 图模型 | ✅ | 网络流 |
| 残量网络 | ✅ | 修正自由度 |
| 增广路径 | ✅ | 算法成立 |

---

## 9. 方法论总结（精华）

> **最大流算法不是“设计出来的”  
> 而是“被 Greedy 的失败逼出来的”**

真正的创新点不是：
- Ford–Fulkerson 的实现细节

而是：
- **Residual Network 这一建模升级**

---

## 10. 可迁移的通用经验

### 当你遇到类似问题时，问自己：

1. 决策是否需要可撤销？
2. 是否存在“反向自由度”？
3. 问题是否本质是：
   - 资源流动
   - 全局约束
   - 结构不变量？

👉 如果是：
→ 考虑 **Flow / Matching / Cut**

---

## 一句话终极总结

> **DP 失败告诉你“问题不局部”  
> Greedy 失败告诉你“问题不单向”  
> 残量网络告诉你“问题是结构性的”**

